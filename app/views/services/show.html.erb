<%= render_headline "Service &raquo;" + @service.name  + "&laquo; on &raquo;" + @service.host + "&laquo;" %>

<div id="service">
	<% if @service.state.blank? %>
		<div class="instantstate-warn">
			<%= showIcon "warning", "float: left; margin-right: 3px;" %>
			This service has not been checked yet!
		</div>
	<% end %>
	<% if @service.state == 0 %>
		<div class="instantstate-error">
			<%= showIcon "error", "float: left; margin-right: 3px;" %>
			The service is not reachable or responses with a wrong protocol!
		</div>
	<% end %>
	<% if @service.state == 1 %>
		<div class="instantstate-okay">
			<%= showIcon "okay", "float: left; margin-right: 3px;" %>
			The service is reachable and responses fast enough!
		</div>
	<% end %>
	<% if @service.state == 2 %>
		<div class="instantstate-warn">
			<%= showIcon "warning", "float: left; margin-right: 3px;" %>
			The service is reachable but has a too high response time!
		</div>
	<% end %>
	<% if @service.state == 3 %>
		<div class="instantstate-internal-error">
			<%= showIcon "error", "float: left; margin-right: 3px;" %>
			Internal ScopePort error. Service could not be checked.
		</div>
	<% end %>
	<dl>
		<dt>Host</dt>
  	<dd><%=h @service.host %></dd>
  	<dt>Port</dt>
  	<dd><%=h @service.port %></dd>
  	<dt>Protocol check</dt>
		<% if @service.service_type == "none" %>
			<dd>None</dd>
		<% else %>
			<dd><%=h @service.service_type.upcase %></dd>
		<% end %>
		<dt>Last checked</dt>
		<% if @service.lastcheck == 0 %>
			<dd>Never</dd>
		<% else %>
			<dd><%=h time_ago_in_words(Time.at @service.lastcheck)  %> ago</dd>
		<% end %>
   	<dt>Response time</dt>
   	<dd><%=h @service.responsetime %> ms (Maximum: <%= @service.maxres %> ms)</dd>
   	<dt>Timeout</dt>
   	<dd><%=h @service.timeout %> seconds</dd>
   	<dt>Handler</dt>
   	<dd>#<%=h @service.handler %></dd>
  </dl>

</div>

<div id="service-graph-response">
	<% if @graphStatus == 1 %>
		<%= image_tag "graphs/" + @graphName %>
	<% elsif @graphStatus == 2 %>
		<div id="graph">
			<strong>
				This graph has a lot of data that needs to be updated. Please 
				<%= link_to_remote( "click here",
						:update => "graph",
						:url =>{ :action => :show_graph, :id => @service.id }) %>
		 		to load it.
			</strong>
			<br />
			This has not been done automatically to avoid unnecessary waiting time.
		</div>
	<% else %>
		<strong>Internal error. Could not create graph</strong>
	<% end %>
</div>

<div class="comments">
  <h2>Comments</h2><br />
  <% if @service.servicecomments.blank? %>
    <div class="comment-body">
      <strong>No comments on this service yet.</strong>
    </strong>
  <% end %>

  <% @service.servicecomments.each do |comment| %>
    <div class="comment">
      <div class="comment-head">
        <%= showIcon "comment" %>
        <span class="comment-title">
          <%= link_to h(comment.user.login), :controller => "users",
                                             :action => "show",
                                             :id => comment.user.id  %>:
          <%=h comment.title %>
        </span>
        <span class="comment-date"><%=h comment.created_at %></span>
      </div>
      <div class="comment-body">
        <%= simple_format h(comment.comment) %>
      </div>
    </div>
    - TODO: Show all comments, Order -
  <% end %>
</div>

<div class="new-comment">
  <h2>New comment</h2>
  <% form_for :new_comment, :url => { :action => "store_comment" } do |f| %>
    <%= f.hidden_field :service_id, :value => @service.id %>
    <%= f.label :title, "Title", :float => "left" %>
    <%= f.text_field :title %>
    <%= f.label :comment, "Comment", :float => "left" %>
    <%= f.text_area :comment, :cols => "80", :rows => "5" %>
    <div class="comment-description">
      <strong>Use this form to leave a comment on this service.</strong>
      You can delete your own comments at any time. Note that your name
      will be visible above the comment.

      <br /><br />

      No HTML allowed. Lines break automatically.
    </div>
    <p><%= submit_tag "Add comment", :disable_with => "Please wait" %></p>
  <% end %>
</div>


<div id="service-delete">
	<% form_tag :action => "delete", :id => @service.id do %>
		<%= submit_tag "Delete this service", :disable_with => "Please wait" %>
	<% end %>
</div>
